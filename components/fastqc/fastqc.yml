$schema: https://azuremlschemas.azureedge.net/latest/commandComponent.schema.json

name: seq_quality_control
display_name: Fastqc Parallel
type: parallel
compute: azureml:genomics-cluster
inputs:
  input_folder: 
    type: uri_folder
    mode: ro_mount
outputs:
  output_folder:
    type: uri_folder
    mode: rw_mount
  output_files:
    type: uri_file
    mode: rw_mount

input_data: ${{inputs.input_folder}}
mini_batch_size: "1"
resources:
    instance_count: 4
max_concurrency_per_instance: 2

logging_level: "DEBUG"
mini_batch_error_threshold: 1
retry_settings:
  max_retries: 1
  timeout: 1200

task:
  type: run_function
  code: "./"
  entry_script: fastqc_parallel.py
  environment: azureml:fastqc-env@latest

  program_arguments: >-
    --output_folder ${{outputs.output_folder}}
    --model "none"
    --error_threshold -1
    --allowed_failed_percent 10
    --task_overhead_timeout 1200
    --progress_update_timeout 6000
    --first_task_creation_timeout 600
    --copy_logs_to_parent True
    --resource_monitor_interval 20
  append_row_to: ${{outputs.output_files}}
